syntax = "proto3";

package kantaloupe.dynamia.ai.api.nodes.v1alpha1;

option go_package = "github.com/dynamia-ai/kantaloupe/api/nodes/v1alpha1";

import "api/types/objectmeta.proto";
import "api/types/page.proto";

// Get Nodes information List.
message ListNodesRequest {
    // Name is the user-specified identifier.
    // This field may not be updated.
    string cluster = 1;

    // Page requested.
    int32 page = 2;

    // Size per page requested.
    int32 page_size = 3;

    // sort_option determines the cluster list order reference.
    kantaloupe.dynamia.ai.api.types.SortOption sort_option = 4;
}

// Nodes information List.
message ListNodesResponse {
    // data The data field is the YAML details
    repeated Node items = 1;

    // Pagination returned contains current page, size, and total.
    kantaloupe.dynamia.ai.api.types.Pagination pagination = 2;
}

// Nodes summary Request
message GetNodeSummaryRequest {
    string cluster = 1;

    string nodeID = 2;
}

// Nodes summary Response
message GetNodeSummaryResponse {
    NodeInformation inform = 1;

    int64 cpuCount = 2;

    int64 memoryCapacity = 3;

    int64 gpuCount = 4;

    int64 gpuMemoryCapacity = 5;
}

message GetNodeEventsRequest {
    string cluster = 1;

    string nodeID = 2;
}

message GetNodeEventsResponse {
    repeated NodeResourceEvents events = 1;
}

message GetNodeStatusRequest {
    string cluster = 1;

    string nodeID = 2;
}

message GetNodeStatusResponse {
    repeated NodeStatus events = 1;
}

message NodeStatus {
    string type = 1;

    string status = 2;

    string updateTimestamp = 3;

    string message = 4;
}

message NodeResourceEvents {
    string timestamp = 1;

    string type = 2;

    string reason = 3;

    string message = 4;
}

message NodeResourceTrend {
    string metrics = 1;

    repeated NodeResourceTimestamp points = 2;
}

message NodeResourceTimestamp {
    int64 timestamp = 1;

    float value = 2;
}

message GetNodeKVRequest {
    string cluster = 1;

    string nodeID = 2;

    string kvName = 3;
}

message GetNodeKVResponse {
    repeated KvValues data = 1;
}

message KvValues {
    string key = 1;

    string value = 2;
}

message GPUUsage {
    int64 gpuIndex = 1;

    int64 workloadCount = 2;
}

// Nodes Overview
message NodeInformation {
    string kubeletVersion = 1;

    string os = 2;

    string ctrVersion = 3;

    string kernelVersion = 4;

    string arch = 5;

    string cudaVersion = 6;

    string nvDriverVersion = 7;

    string createTimestamp = 8;
}

message Node {
    // Standard object's metadata.
    kantaloupe.dynamia.ai.api.types.ObjectMeta metadata = 1;

    string name = 2;

    bool health = 3;

    string character = 4;

    ResourceUsage cpucore = 5;

    ResourceUsage memory = 6;

    ResourceUsage gpuutil = 7;

    ResourceUsage gpumem = 8;

    string ipaddr = 9;

    string createtimestamp = 10;
}

message ResourceUsage {
    float used = 1;

    float allocated = 2;

    float total = 3;
}
